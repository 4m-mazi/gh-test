name: on pull_request

on:
  pull_request:
    types:
      - closed
    branches:
      - "develop"
jobs:
  debug:
    name: Debug
    runs-on: ubuntu-latest
    steps:
      - run: cat $GITHUB_EVENT_PATH
      - run: gh --version
      - run: docker --version
      - run: docker-compose --version
  hotfix:
    if: github.event.pull_request.merged
    runs-on: ubuntu-20.04
    env:
      GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      GH_REPO: ${{ github.repository }}
      PR_NUMBER: ${{ github.event.number }}
    steps:
      - run: |
          ISSUES=`gh pr view $PR_NUMBER --json body --jq .body |
                  grep -oP '(^|\s)((close|resolve)(|s|d)|fix(|es|ed)) #[\d]+(?=(\s|$))' |
                  grep -oP '#[\d]+'`
          echo $ISSUES | xargs -n1 gh issue close || true
